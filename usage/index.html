<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Katy Scott" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Usage - READII-2-ROQC</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Usage";
        var mkdocs_page_input_path = "usage.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> READII-2-ROQC
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Usage</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#environment">Environment</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#project-configuration">Project Configuration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#datasets">datasets</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#pyradiomics">pyradiomics</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#pyradiomics_1">PyRadiomics</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#signatures">signatures</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#data-setup">Data Setup</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#aliasing-rawdata-and-procdata">Aliasing rawdata and procdata</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#documenting-datasets">Documenting datasets</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#project-data-directory-tree">Project data Directory Tree</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#best-practices">Best Practices</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#running-your-analysis">Running Your Analysis</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../data_sources/">Data Sources</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Notes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../devnotes/katy_notes/">Katy's Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../devnotes/shabnam_notes/">Shabnam's Notes</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">READII-2-ROQC</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Usage</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/bhklab/readii_2_roqc/edit/master/docs/usage.md">Edit on readii_2_roqc</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="usage-guide">Usage Guide</h1>
<h2 id="quick-start">Quick Start</h2>
<ol>
<li>Clone repository from <a href="https://github.com/bhklab/readii_2_roqc">https://github.com/bhklab/readii_2_roqc</a></li>
<li>Install environment with <code>pixi install</code></li>
<li>Place image data in <code>data/rawdata/{YOUR_DATASET_NAME}/images</code></li>
<li>Make dataset configuration file following <code>dataset_config_template.yaml</code> in <code>config/datasets</code></li>
<li>Run med-imagetools with <code>pixi run mit {YOUR_DATASET_NAME} 'CT,RTSTRUCT' SEPARATE 'ROI:{YOUR_ROI_LIST}'</code></li>
<li>Run readii with <code>pixi run readii_negative NSCLC-Radiomics false true 6</code></li>
<li>Run feature extraction with <code>pixi run extract {YOUR_DATASET_NAME} pyradiomics linear_all_image_features.yaml</code></li>
</ol>
<h2 id="environment">Environment</h2>
<p><strong>IMPORTANT NOTE</strong> This project will not work with Med-ImageTools properly with Python 3.12 or above. The pixi environment must have Python &lt; 3.12 installed.</p>
<h2 id="project-configuration">Project Configuration</h2>
<p><code>config</code> should have three subdirectories: <code>datasets/</code>, <code>pyradiomics/</code>, and <code>signatures/</code></p>
<h3 id="datasets">datasets</h3>
<p>Each dataset needs a configuration file with the following settings filled in</p>
<div class="highlight"><pre><span></span><code>DATA_SOURCE: &quot;&quot;    # where the data came from, will be used for data organization
DATASET_NAME: &quot;&quot;   # the name of the dataset , will be use for data organization

### CLINICAL VARIABLE INFORMATION ###
CLINICAL:
    FILE: &quot;&quot;                     # Name of the clinical data file associated with the data. Not a full path, just the name including the file suffix.
    OUTCOME_VARIABLES:
        event_label: &quot;&quot;          # Column name for survival event in the `FILE`, can be numeric, string, or bool
        event_value_mapping: {}  # Customize the `event_label` bool or string mapping to numeric type. Ex. {&#39;Event value&#39;: 1, &#39;No event value&#39;: 0}
        time_label: &quot;&quot;           # Column name for survival time in the `FILE`, should be a numeric type
        convert_to_years: False  # Boolean, whether the `time_label` needs to be converted from days to years    
    EXCLUSION_VARIABLES: {}      # Column values of rows to drop in the clinical data (Ex. `{column_name: [val1, val2]}` )
    INCLUSION_VARIABLES: {}      # Column values of rows to select out of the clinical data

### MED-IMAGETOOLS settings
MIT:
    MODALITIES:                 # Modalities to process with autopipeline
        image: CT
        mask: RTSTRUCT     
    ROI_STRATEGY: MERGE         # How to handle multiple ROI matches 
    ROI_MATCH_MAP: KEY:ROI_NAME # Matching map for ROIs in dataset (use if you only want to process some of the masks in a segmentation)
                                # NOTE: there can be no spaces in KEY:ROI_NAME

### READII settings
READII:
    IMAGE_TYPES:                # Selection of image types to generate and perform feature extraction on (negative control settings)
        regions:                # Areas of image to apply permutation to
            - &quot;full&quot;
        permutations:           # Permutation type to apply to region
            - &quot;shuffled&quot;
        crop:
            - &quot;cube&quot;            # How to crop the image prior to feature extraction. Leave blank for no cropping.
        resize: [50]            # Size to crop the image to. Image will be resampled. Leave blank for no resampling.

### Feature Extraction settings
EXTRACTION:
    METHOD: pyradiomics                 # Extraction method to apply
    CONFIG: linear_all_images_features  # Configuration settings to use for extraction. Must have file in config/

### Analysis settings
ANALYSIS:   
    TRAIN_TEST_SPLIT:           # If using data for modelling, set up method of data splitting here
        split: False            # Whether to split the data
        split_variable: {}      # What variable from `CLINICAL.FILE` to use to split the data and values to group by (Ex. {&#39;split_var&#39;: [&#39;training&#39;, &#39;test&#39;]})
        impute: null            # What to impute values in `split_variable` with. Should be one of the values provided in `split_variable`. If none provided, won&#39;t impute, samples with no split value will be dropped.

RANDOM_SEED: 10                 # Seed for reproducibility of analysis.
</code></pre></div>
<h3 id="pyradiomics">pyradiomics</h3>
<p>This directory should store any configuration settings used for feature extraction. They should be named/organized by the feature extraction method.</p>
<p>Example: <code>pyradiomics_original_all_features.yaml</code></p>
<p>Different configuration set-ups can be documented here.</p>
<h4 id="pyradiomics_1">PyRadiomics</h4>
<p>PyRadiomics feature extraction settings yaml files should be kept here. See the PyRadiomics <a href="https://pyradiomics.readthedocs.io/en/latest/customization.html#parameter-file">'Parameter File'</a> documentation for details about this file.</p>
<h3 id="signatures">signatures</h3>
<p>Files in this directory should list selected features in a radiomic signature and the corresponding weights from a fitted prediction model. </p>
<div class="admonition example">
<p class="admonition-title">PyRadiomics CoxPH signature</p>
<div class="highlight"><pre><span></span><code>signature:
    &#39;original_firstorder_Energy&#39;: 1.74e-11
    &#39;original_shape_Compactness1&#39;: -1.65e+01
    &#39;original_glrlm_GrayLevelNonUniformity&#39;: 4.95e-05
    &#39;wavelet-HLH_glrlm_GrayLevelNonUniformity&#39;: 2.81e-06
</code></pre></div>
</div>
<hr />
<h2 id="data-setup">Data Setup</h2>
<p>All data should be stored in a Data directory separate from this project directory. Within the project repo, there's a <code>data</code> directory containing <code>rawdata</code>, <code>procdata</code>, and <code>results</code> directories. The <code>rawdata</code> and <code>procdata</code> directories should by <strong>symbolic links</strong> pointing to the corresponding data directory in your separate Data directory.</p>
<h3 id="aliasing-rawdata-and-procdata">Aliasing <code>rawdata</code> and <code>procdata</code></h3>
<p>To set up the symbolic links for the <code>rawdata</code> and <code>procdata</code> directories, run the following commands, starting from your project directory:</p>
<div class="highlight"><pre><span></span><code>ln<span class="w"> </span>-s<span class="w"> </span>/path/to/separate/data/dir/rawdata/<span class="o">{</span>DiseaseRegion<span class="o">}</span>/<span class="o">{</span>DATASET_SOURCE<span class="o">}</span>_<span class="o">{</span>DATASET_NAME<span class="o">}</span><span class="w"> </span>data/rawdata/<span class="o">{</span>DATASET_SOURCE<span class="o">}</span>_<span class="o">{</span>DATASET_NAME<span class="o">}</span>

ln<span class="w"> </span>-s<span class="w"> </span>/path/to/separate/data/dir/procdata/<span class="o">{</span>DiseaseRegion<span class="o">}</span>/<span class="o">{</span>DATASET_SOURCE<span class="o">}</span>_<span class="o">{</span>DATASET_NAME<span class="o">}</span><span class="w"> </span>data/procdata/<span class="o">{</span>DATASET_SOURCE<span class="o">}</span>_<span class="o">{</span>DATASET_NAME<span class="o">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will need to perform this step for each dataset you wish to process with the READII-2-ROQC pipeline.</p>
</div>
<h3 id="documenting-datasets">Documenting datasets</h3>
<p>When a new dataset has been added to the <code>rawdata</code> directory, you <strong>MUST</strong> document it on the <a href="../data_sources/">Data Sources</a> page. </p>
<p>Copy the following template and fill it in accordingly for each dataset. If anything about the dataset changes, make sure to keep this page up to date.</p>
<div class="admonition example">
<p class="admonition-title">Data Source Template</p>
<div class="highlight"><pre><span></span><code>NSCLC-Radiomics

<span class="k">-</span><span class="w"> </span><span class="gs">**Name**</span>: NSCLC-Radiomics (or Lung1)
<span class="k">-</span><span class="w"> </span><span class="gs">**Version/Date**</span>: Version 4: Updated 2020/10/22
<span class="k">-</span><span class="w"> </span><span class="gs">**URL**</span>: &lt;https://www.cancerimagingarchive.net/collection/nsclc-radiomics/&gt;
<span class="k">-</span><span class="w"> </span><span class="gs">**Access Method**</span>: NBIA Data Retriever
<span class="k">-</span><span class="w"> </span><span class="gs">**Access Date**</span>: 2025-04-23
<span class="k">-</span><span class="w"> </span><span class="gs">**Data Format**</span>: DICOM
<span class="k">-</span><span class="w"> </span><span class="gs">**Citation**</span>: Aerts, H. J. W. L., Wee, L., Rios Velazquez, E., Leijenaar, R. T. H., Parmar, C., Grossmann, P., Carvalho, S., Bussink, J., Monshouwer, R., Haibe-Kains, B., Rietveld, D., Hoebers, F., Rietbergen, M. M., Leemans, C. R., Dekker, A., Quackenbush, J., Gillies, R. J., Lambin, P. (2014). Data From NSCLC-Radiomics (version 4) [Data set]. The Cancer Imaging Archive. https://doi.org/10.7937/K9/TCIA.2015.PF0M9REI 
<span class="k">-</span><span class="w"> </span><span class="gs">**License**</span>: [<span class="nt">CC BY-NC 3.0</span>](<span class="na">https://creativecommons.org/licenses/by-nc/3.0/</span>)
<span class="k">-</span><span class="w"> </span><span class="gs">**Data Types**</span>: 
<span class="w">    </span><span class="k">-</span><span class="w"> </span>Images: CT, RTSTRUCT
<span class="w">    </span><span class="k">-</span><span class="w"> </span>Clinical: CSV
<span class="k">-</span><span class="w"> </span><span class="gs">**Sample Size**</span>: 422 subjects
<span class="k">-</span><span class="w"> </span><span class="gs">**ROI Name**</span>: Tumour = GTV-1
<span class="k">-</span><span class="w"> </span><span class="gs">**Notes**</span>: LUNG-128 does not have a GTV segmentation, so only 421 patients are processed.
</code></pre></div>
</div>
<h3 id="project-data-directory-tree">Project <code>data</code> Directory Tree</h3>
<div class="highlight"><pre><span></span><code>data
<span class="p">|</span>--<span class="w"> </span>procdata
<span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>DATASET_SOURCE<span class="o">}</span>_<span class="o">{</span>DATASET_NAME<span class="o">}</span><span class="w"> </span>--&gt;<span class="w"> </span>/path/to/separate/data/dir/procdata/<span class="o">{</span>DiseaseRegion<span class="o">}</span>/<span class="o">{</span>DATASET_SOURCE<span class="o">}</span>_<span class="o">{</span>DATASET_NAME<span class="o">}</span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>clinical
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>DATASET_NAME<span class="o">}</span>_disease_subset.csv
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>DATASET_NAME<span class="o">}</span>_outcome_data.csv
<span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>correlations
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>extraction_method<span class="o">}</span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>extraction_configuration_file_name<span class="o">}</span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">           </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>image_type<span class="o">}</span>_<span class="o">{</span>correlation_method<span class="o">}</span>_matrix.csv
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">           </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>image_type<span class="o">}</span>_v_<span class="o">{</span>image_type<span class="o">}</span>_<span class="o">{</span>correlation_method<span class="o">}</span>_matrix.csv
<span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>features
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>extraction_method<span class="o">}</span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>crop<span class="o">}</span>_<span class="o">{</span>resize_x<span class="o">}</span>_<span class="o">{</span>resize_y<span class="o">}</span>_<span class="o">{</span>resize_z<span class="o">}</span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>extraction_configuration_file_name<span class="o">}</span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>PatientID<span class="o">}</span>_<span class="o">{</span>SampleNumber<span class="o">}</span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">           </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>ROI_name<span class="o">}</span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">               </span><span class="p">|</span>--<span class="w"> </span>original_full_features.csv
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">               </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>_features.csv
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">               </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>_features.csv
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span>original_<span class="o">{</span>size_x<span class="o">}</span>_<span class="o">{</span>size_y<span class="o">}</span>_n<span class="w"> </span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">           </span><span class="p">|</span>--<span class="w"> </span>extraction_method_index.csv
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">           </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>extraction_configuration_file_name<span class="o">}</span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">               </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>PatientID<span class="o">}</span>_<span class="o">{</span>SampleNumber<span class="o">}</span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">                   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>ROI_name<span class="o">}</span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>--<span class="w"> </span>original_full_features.csv
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">                       </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>_features.csv
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">                       </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>_features.csv
<span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>images
<span class="p">|</span><span class="w">           </span><span class="p">|</span>--<span class="w"> </span>mit_<span class="o">{</span>DATASET_NAME<span class="o">}</span>
<span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>PatientID<span class="o">}</span>_<span class="o">{</span>SampleNumber<span class="o">}</span>
<span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span><span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>ImageModality<span class="o">}</span>_<span class="o">{</span>SeriesInstanceUID<span class="o">}</span>
<span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span><span class="p">|</span><span class="w">   </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>ImageModality<span class="o">}</span>.nii.gz
<span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>SegmentationModality<span class="o">}</span>_<span class="o">{</span>SeriesInstanceUID<span class="o">}</span>
<span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>ROI_name<span class="o">}</span>.nii.gz
<span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span>mit_<span class="o">{</span>DATASET_NAME<span class="o">}</span>_index-simple.csv
<span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span>mit_<span class="o">{</span>DATASET_NAME<span class="o">}</span>_index.csv
<span class="p">|</span><span class="w">           </span><span class="sb">`</span>--<span class="w"> </span>readii_<span class="o">{</span>DATASET_NAME<span class="o">}</span>
<span class="p">|</span><span class="w">               </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>crop<span class="o">}</span>_<span class="o">{</span>resize_x<span class="o">}</span>_<span class="o">{</span>resize_y<span class="o">}</span>_<span class="o">{</span>resize_z<span class="o">}</span>
<span class="p">|</span><span class="w">               </span><span class="p">|</span><span class="w">   </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>PatientID<span class="o">}</span>_<span class="o">{</span>SampleNumber<span class="o">}</span>
<span class="p">|</span><span class="w">               </span><span class="p">|</span><span class="w">   </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>ImageModality<span class="o">}</span>_<span class="o">{</span>SeriesInstanceUID<span class="o">}</span>
<span class="p">|</span><span class="w">               </span><span class="p">|</span><span class="w">   </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>original_full.nii.gz<span class="w">    </span>
<span class="p">|</span><span class="w">               </span><span class="p">|</span><span class="w">   </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>.nii.gz
<span class="p">|</span><span class="w">               </span><span class="p">|</span><span class="w">   </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>.nii.gz
<span class="p">|</span><span class="w">               </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span>readii_<span class="o">{</span>DATASET_NAME<span class="o">}</span>_index.csv
<span class="p">|</span><span class="w">               </span><span class="sb">`</span>--<span class="w"> </span>original_<span class="o">{</span>size_x<span class="o">}</span>_<span class="o">{</span>size_y<span class="o">}</span>_n
<span class="p">|</span><span class="w">                   </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>PatientID<span class="o">}</span>_<span class="o">{</span>SampleNumber<span class="o">}</span>
<span class="p">|</span><span class="w">                   </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>ImageModality<span class="o">}</span>_<span class="o">{</span>SeriesInstanceUID<span class="o">}</span>
<span class="p">|</span><span class="w">                   </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>.nii.gz
<span class="p">|</span><span class="w">                   </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>.nii.gz
<span class="p">|</span><span class="w">                   </span><span class="sb">`</span>--<span class="w"> </span>readii_<span class="o">{</span>DATASET_NAME<span class="o">}</span>_index.csv
<span class="p">|</span>--<span class="w"> </span>rawdata
<span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>DATASET_SOURCE<span class="o">}</span>_<span class="o">{</span>DATASET_NAME<span class="o">}</span><span class="w"> </span>--&gt;<span class="w"> </span>/path/to/separate/data/dir/srcdata/<span class="o">{</span>DiseaseRegion<span class="o">}</span>/<span class="o">{</span>DATASET_SOURCE<span class="o">}</span>_<span class="o">{</span>DATASET_NAME<span class="o">}</span>
<span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>clinical
<span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>Clinical<span class="w"> </span>Data<span class="w"> </span>File<span class="o">}</span>.csv<span class="w"> </span>OR<span class="w"> </span><span class="o">{</span>Clinical<span class="w"> </span>Data<span class="w"> </span>File<span class="o">}</span>.xlsx
<span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span>images
<span class="p">|</span><span class="w">           </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>DATASET_NAME<span class="o">}</span>
<span class="p">|</span><span class="w">               </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>Sample1<span class="w"> </span>DICOM<span class="w"> </span>directory<span class="o">}</span>
<span class="p">|</span><span class="w">               </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>Sample2<span class="w"> </span>DICOM<span class="w"> </span>directory<span class="o">}</span>
<span class="p">|</span><span class="w">               </span><span class="p">|</span>--<span class="w"> </span>...
<span class="p">|</span><span class="w">               </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>SampleN<span class="w"> </span>DICOM<span class="w"> </span>directory<span class="o">}</span>
<span class="sb">`</span>--<span class="w"> </span>results
<span class="w">    </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>DATASET_SOURCE<span class="o">}</span>_<span class="o">{</span>DATASET_NAME<span class="o">}</span>
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>correlation
<span class="w">        </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>extraction_method<span class="o">}</span>
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>extraction_configuration_file_name<span class="o">}</span>
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>signature_name<span class="o">}</span>
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>features
<span class="w">        </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>extraction_method<span class="o">}</span>
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>crop<span class="o">}</span>_<span class="o">{</span>resize_x<span class="o">}</span>_<span class="o">{</span>resize_y<span class="o">}</span>_<span class="o">{</span>resize_z<span class="o">}</span>
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>extraction_configuration_file_name<span class="o">}</span>
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>original_full_features.csv
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>_features.csv
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span>original_<span class="o">{</span>size_x<span class="o">}</span>_<span class="o">{</span>size_y<span class="o">}</span>_n
<span class="w">        </span><span class="p">|</span><span class="w">           </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>extraction_configuration_file_name<span class="o">}</span>
<span class="w">        </span><span class="p">|</span><span class="w">               </span><span class="p">|</span>--<span class="w"> </span>original_full_features.csv
<span class="w">        </span><span class="p">|</span><span class="w">               </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>_features.csv
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>prediction
<span class="w">        </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>signature_name<span class="o">}</span>
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>prediction_metrics.csv
<span class="w">        </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span>hazards_<span class="o">{</span>bootstrap_count<span class="o">}</span>
<span class="w">        </span><span class="p">|</span><span class="w">           </span><span class="p">|</span>--<span class="w"> </span>original_full_features.csv
<span class="w">        </span><span class="p">|</span><span class="w">           </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>_features.csv
<span class="w">        </span><span class="p">|</span><span class="w">           </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>_features.csv
<span class="w">        </span><span class="sb">`</span>--<span class="w"> </span>visualization
<span class="w">            </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>signature_name<span class="o">}</span><span class="w"> </span>
<span class="w">            </span><span class="sb">`</span>--<span class="w"> </span>feature_correlation
<span class="w">                </span><span class="p">|</span>--<span class="w"> </span>cross
<span class="w">                </span><span class="p">|</span><span class="w">   </span><span class="sb">`</span>--<span class="w"> </span>heatmap
<span class="w">                </span><span class="p">|</span><span class="w">       </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>colormap<span class="o">}</span>
<span class="w">                </span><span class="p">|</span><span class="w">           </span><span class="p">|</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>_<span class="o">{</span>filter<span class="o">}</span>_vs_<span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>_<span class="o">{</span>filter<span class="o">}</span>_<span class="o">{</span>correlation_method<span class="o">}</span>_correlation_heatmap.png
<span class="w">                </span><span class="p">|</span><span class="w">           </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>_<span class="o">{</span>filter<span class="o">}</span>_vs_original_full_<span class="o">{</span>filter<span class="o">}</span>_<span class="o">{</span>correlation_method<span class="o">}</span>_correlation_heatmap.png
<span class="w">                </span><span class="sb">`</span>--<span class="w"> </span>self
<span class="w">                    </span><span class="sb">`</span>--<span class="w"> </span>heatmap
<span class="w">                        </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>colormap<span class="o">}</span>
<span class="w">                            </span><span class="p">|</span>--<span class="w"> </span>original_full_<span class="o">{</span>filter<span class="o">}</span>_<span class="o">{</span>correlation_method<span class="o">}</span>_correlation_heatmap.png
<span class="w">                            </span><span class="sb">`</span>--<span class="w"> </span><span class="o">{</span>permutation<span class="o">}</span>_<span class="o">{</span>region<span class="o">}</span>_<span class="o">{</span>filter<span class="o">}</span>_<span class="o">{</span>correlation_method<span class="o">}</span>_correlation_heatmap.png
</code></pre></div>
<h3 id="best-practices">Best Practices</h3>
<ul>
<li>Store raw data in <code>data/rawdata/</code> and never modify it</li>
<li>Store processed data in <code>data/procdata/</code> and all code used to generate it should be in <code>src/readii_2_roqc</code></li>
<li>Track data provenance (where data came from and how it was modified)</li>
<li>Respect data usage agreements and licenses!
    This is especially important for data that should not be shared publicly</li>
</ul>
<h2 id="running-your-analysis">Running Your Analysis</h2>
<p>The pipeline is currently being run via <code>pixi</code> tasks. The following example shows how to run the pipeline using the <code>NSCLC-Radiomics</code> data.</p>
<h1 id="dicom-image-and-mask-file-processing-with-med-imagetools">DICOM Image and Mask file processing with Med-ImageTools</h1>
<p>This step converts the DICOM image files to NIfTI files, creates a unique ID for Image and Mask pairs, and generates an index file containing relevant metadata.</p>
<h2 id="step-1-run-med-imagetools">Step 1: Run Med-ImageTools</h2>
<p>This step converts the DICOM files to NIfTIs, assigns unique SampleIDs to image and mask pairs, and generates an index table for each file with associated metadata (e.g. DICOM tags)</p>
<div class="highlight"><pre><span></span><code>pixi<span class="w"> </span>run<span class="w"> </span>mit<span class="w"> </span>NSCLC-Radiomics<span class="w"> </span><span class="s1">&#39;CT,RTSTRUCT&#39;</span><span class="w"> </span>SEPARATE<span class="w"> </span><span class="s1">&#39;GTV:GTV-1,gtv-pre-op&#39;</span>
</code></pre></div>
<p>If you would like to customize the med-imagetools autopipeline run, you can run the following in the command line with changes:</p>
<div class="highlight"><pre><span></span><code>imgtools<span class="w"> </span>autopipeline<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--filename-format<span class="w"> </span><span class="s1">&#39;{PatientID}_{SampleNumber}/{Modality}_{SeriesInstanceUID}/{ImageID}.nii.gz&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--modalities<span class="w"> </span>CT,RTSTRUCT<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--roi-strategy<span class="w"> </span>SEPARATE<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-rmap<span class="w"> </span><span class="s1">&#39;GTV:GTV-1,gtv-pre-op&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--spacing<span class="w"> </span><span class="m">1</span>,1,1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--window-level<span class="w"> </span><span class="m">8500</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--window-width<span class="w"> </span><span class="m">23000</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data/rawdata/TCIA_NSCLC-Radiomics/images<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>data/procdata/TCIA_NSCLC-Radiomics/images/mit_NSCLC-Radiomics
</code></pre></div>
<ul>
<li>Please keep the filename-format as shown for the remainder of the readii-2-roqc pipeline to complete as expected.</li>
<li>The output procdata directory suffix after <code>mit_</code> must match the configuration file you created for this dataset.</li>
</ul>
<h2 id="step-2-generate-negative-control-images-with-readii">Step 2: Generate negative control images with READII</h2>
<p>This step creates and saves READII negative controls specified in the config file for the provided dataset. </p>
<p>It is recommended to run this in parallel for large datasets. Provided <code>n-4</code> jobs with n being the compute nodes available.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Run the command with overwrite set to false, parallel set to true with 6 jobs</span>
pixi<span class="w"> </span>run<span class="w"> </span>readii_negative<span class="w"> </span>NSCLC-Radiomics<span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="m">6</span>
</code></pre></div>
<h3 id="step-3-run-feature-extraction">Step 3: Run feature extraction</h3>
<p>This step first generates an index file for the specific feature extraction method, where each row contains the information for the image and mask pair to use.</p>
<div class="highlight"><pre><span></span><code>pixi<span class="w"> </span>run<span class="w"> </span>extract<span class="w"> </span>NSCLC-Radiomics<span class="w"> </span>pyradiomics<span class="w"> </span>pyradiomics_original_all_features.yaml
</code></pre></div>
<h2 id="survival-modelling">Survival Modelling</h2>
<h3 id="resources">Resources</h3>
<p>https://scikit-survival.readthedocs.io/en/stable/user_guide/evaluating-survival-models.html#</p>
<p>Harrell's C-index: https://scikit-survival.readthedocs.io/en/stable/api/generated/sksurv.metrics.concordance_index_censored.html</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../data_sources/" class="btn btn-neutral float-right" title="Data Sources">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/bhklab/readii_2_roqc" class="fa fa-code-fork" style="color: #fcfcfc"> readii_2_roqc</a>
        </span>
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../data_sources/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
