from damply import dirs as dmpdirs
from pathlib import Path

# could alternatively pass this in the CLI via `--configfile $CONFIG/config.yaml`
configfile: dmpdirs.CONFIG / "datasets" / "HEAD-NECK-RADIOMICS-HN1.yaml"

COMBINED_DATA_NAME = config["DATA_SOURCE"] + "_" + config["DATASET_NAME"]

# print(COMBINED_DATA_NAME)

# rule run_mit_autopipeline:
#     input:
#         input_directory=dmpdirs.RAWDATA / COMBINED_DATA_NAME / "images" / config["DATASET_NAME"]
#         output_directory=dmpdirs.PROCDATA / COMBINED_DATA_NAME / "images" / f"mit_{config["DATASET_NAME"]}"
#     output:
#         output_directory=dmpdirs.PROCDATA / COMBINED_DATA_NAME / "images" / f"mit_{config["DATASET_NAME"]}" 
#     shell:
#         """
#         imgtools autopipeline 
#         """   

rule run_mit_index:
    input:
        dicom_dir=dmpdirs.RAWDATA / COMBINED_DATA_NAME / "images" / config["DATASET_NAME"],
    output:
        directory(dmpdirs.RAWDATA / COMBINED_DATA_NAME / "images/.imgtools" / config["DATASET_NAME"])
    params:
        dataset_name= config["DATASET_NAME"]
    shell:
        """
        imgtools index --dicom-dir {input.dicom_dir} --dataset-name {params.dataset_name} --force
        """